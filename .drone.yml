kind: pipeline
name: AstroJS

steps:
- name: build astro
  image: node
  commands:
  - npm install
  - npm run build
- name: push to dockerhub
  image: plugins/docker
  settings:
    username: sford1sudo
    password:
      from_secret: dhubpass
    repo: sford1sudo/astro
    tags: latest
- name: discord notification
  image: appleboy/drone-discord
  settings:
    webhook_id:
      from_secret: discordwebhookid
    webhook_token: 
      from_secret: discordwebhooktoken
    message: "Astro site has been built and pushed to dockerhub successfully"
- name: deploy with ansible
  image: plugins/ansible:3
  settings:
    playbook: ansible/astro.yml
    inventory: ansible/hosts
    syntax_check: true
